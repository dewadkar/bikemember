{
    "collab_server" : "",
    "contents" : "library(dplyr)\nlibrary(plotly)\ninstall.packages(\"zoo\")\nlibrary(zoo)\n\ntrip_by_date <- trip_data %>%\n  group_by(Start.date) %>%\n  summarise(Trip.count = n()) %>%\n  filter(!is.na(Start.date))\n\n\n# Daily ridership\nroll_avg <- rollmean(trip_by_date$Trip.count, 30)\n\ntrip_by_date2 <- trip_by_date[30:nrow(trip_by_date), ]\ntrip_by_date2$roll_avg <- roll_avg\n\nplot_ly(trip_by_date2, type = 'scatter', x = ~Start.date, y = ~roll_avg, mode = 'lines') %>%\n  layout(title = \"Daily riders\",\n         xaxis = list(title = \"Date\"),\n         yaxis = list (title = \"30-day rolling average daily riders\"))\n\n# Ridership by month\ntrip_by_month <- trip_by_date %>%\n  mutate(Month_Yr = format(as.Date(Start.date), \"%Y-%m\")) %>%\n  mutate(year = substring(Month_Yr, 1, 4),\n         month = substring(Month_Yr, 6, 7)) %>%\n  group_by(year, month) %>%\n  summarise(Monthly.avg.trips = mean(Trip.count))\n\n# Ridership by season\ntrip_by_season <- trip_by_date %>%\n  mutate(Month_Yr = format(as.Date(Start.date), \"%Y-%m\")) %>%\n  mutate(year = substring(Month_Yr, 1, 4),\n         month = substring(Month_Yr, 6, 7)) %>%\n  filter(year > 2010 & (year != 2016 | month != 10)) %>%\n  mutate(season = ifelse(month %in% c('03', '04', '05', '06', '07', '08', '09', '10', '11', '12'), 'summer', 'winter')) %>%\n  group_by(year, month, season) %>%\n  summarise(Avg.trips = mean(Trip.count)) %>%\n  group_by(year, season) %>%\n  summarise(Monthly.avg.trips = mean(Avg.trips))\n\ntrip_by_season <- data.frame(trip_by_season)\n\nplot_ly(trip_by_season, x=~year, y=~Monthly.avg.trips, color=~season, colors = 'Set1',\n        type='scatter', mode='lines+markers') %>%\n  layout(title = \"Average monthly riders by season\",\n         xaxis = list(title = \"Year\"),\n         yaxis = list (title = \"Average riders per month\"))\n\ncolnames(trip_data)\n# Ridership by subscriber\ntrip_by_date_subscription <- trip_data %>%\n  group_by(Start.date, Member.Type) %>%\n  summarise(Trip.count = n()) %>%\n  filter(!is.na(Start.date))\n\ntrip_by_month_subscription <- trip_by_date_subscription %>%\n  mutate(Month_Yr = format(as.Date(Start.date), \"%Y-%m\")) %>%\n  mutate(year = substring(Month_Yr, 1, 4),\n         month = substring(Month_Yr, 6, 7)) %>%\n  # filter(year != 2016 | month != 10) %>%\n  group_by(year, month, Member.Type) %>%\n  summarise(Avg.trips = mean(Trip.count)) %>%\n  group_by(year, Member.Type) %>%\n  summarise(Monthly.avg.trips = mean(Avg.trips))\n\ntrip_by_month_subscription <- data.frame(trip_by_month_subscription)\n\nplot_ly(trip_by_month_subscription, x=~year, y=~Monthly.avg.trips, color=~Subscription.Type, colors='Set1',\n        type='scatter', mode='lines+markers') %>%\n  layout(title = \"Average monthly riders by rider type\",\n         xaxis = list(title = \"Year\"),\n         yaxis = list (title = \"Average riders per month\"))\n\n# Ridership by season and subscriber\ntrip_by_date_subscription <- trip_data %>%\n  group_by(Start.date, Subscription.Type) %>%\n  summarise(Trip.count = n()) %>%\n  filter(!is.na(Start.date))\n\ntrip_by_season_subscription <- trip_by_date_subscription %>%\n  mutate(Month_Yr = format(as.Date(Start.date), \"%Y-%m\")) %>%\n  mutate(year = substring(Month_Yr, 1, 4),\n         month = substring(Month_Yr, 6, 7)) %>%\n  filter(year != 2016 | month != 10) %>%\n  filter(year > 2010) %>%\n  mutate(season = ifelse(month %in% c('03', '04', '05', '06', '07', '08', '09', '10', '11', '12'), 'summer', 'winter')) %>%\n  group_by(year, month, season, Subscription.Type) %>%\n  summarise(Avg.trips = mean(Trip.count)) %>%\n  group_by(year, season, Subscription.Type) %>%\n  summarise(Monthly.avg.trips = mean(Avg.trips)) %>%\n  mutate(category = paste(Subscription.Type, '-', season))\n\ntrip_by_season_subscription <- as.data.frame(trip_by_season_subscription)\n\nplot_ly(trip_by_season_subscription, x=~year, y=~Monthly.avg.trips, color=~category,\n        type = 'scatter', mode = 'lines+markers', colors = 'Set1') %>%\n  layout(title = \"Average monthly riders by season and rider type\",\n         xaxis = list(title = \"Year\"),\n         yaxis = list (title = \"Average riders per month\"))\n",
    "created" : 1531121285975.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1039053934",
    "id" : "9F9D9305",
    "lastKnownWriteTime" : 1531125602,
    "last_content_update" : 1531125602558,
    "path" : "~/Desktop/ikl/internal/2018/cabitrip/R/charts.R",
    "project_path" : "R/charts.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}